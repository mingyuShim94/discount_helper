# 할인도우미 프로젝트 코드 구조 및 주요 파일 설명

이 문서는 할인도우미 프로젝트의 주요 파일들과 각 파일의 핵심 기능을 설명합니다.

## 폴더 구조

```
discount_helper/
  ├── app/                    # Next.js App Router 페이지
  │   ├── store/              # 매장 관련 페이지
  │   │   └── [id]/           # 개별 매장 페이지 (동적 라우팅)
  │   ├── tips/               # 할인 팁 페이지
  │   └── contact/            # 문의 페이지
  ├── components/             # 컴포넌트
  │   ├── discount/           # 할인 관련 컴포넌트
  │   ├── ui/                 # UI 공통 컴포넌트 (ShadCN)
  │   ├── layout/             # 레이아웃 컴포넌트
  │   ├── tips/               # 할인 팁 컴포넌트
  │   └── store/              # 매장 관련 컴포넌트
  ├── lib/                    # 유틸리티 라이브러리
  │   ├── data/               # 정적 데이터 (매장 정보 등)
  │   └── discount/           # 할인 관련 유틸리티
  ├── utils/                  # 유틸리티 함수
  │   ├── discountCalculator.ts # 할인 계산 관련 함수 모음
  │   └── discountUtils.ts      # 할인 유틸리티 함수
  ├── types/                  # TypeScript 타입 정의
  ├── hooks/                  # React 커스텀 훅
  │   └── useMediaQuery.ts    # 반응형 UI를 위한 미디어 쿼리 훅
  └── public/                 # 정적 파일
```

## 핵심 파일 설명

### 할인 계산 로직

#### `utils/discountCalculator.ts`

할인도우미의 핵심 기능을 담당하는 파일로, 사용자가 선택한 할인 수단에 따라 최적의 할인 방법을 계산합니다.

주요 기능:

- `isWeekend`: 현재 날짜가 금/토/일(주말)인지 확인하는 함수
- `calculateOptimalDiscounts`: 입력 금액에 대한 최적 할인 조합 계산
  - **매장 ID(storeId)를 입력받아 해당 매장의 할인 정책을 동적으로 적용**
  - **lib/data/discountRules.ts에서 getDiscountRules 함수를 통해 매장별 할인 정책 가져옴**
- `calculateDiscount`: 단일 할인에 대한 할인액 계산
- `calculateCombinedDiscount`: 중복 할인 계산 (멤버십 + 카드 등)
- 할인 결과에 즉시 할인, 미래 할인(적립금, 캐시백), 체감가, 총 혜택 금액 구분 제공
- 통신사 멤버십, 네이버 멤버십, 할인카드 등 다양한 할인 수단 조합 처리
- POP 로고 유무에 따른 할인 계산
- 통신사 멤버십(KT, U+)의 최소 결제 금액(1,000원) 조건 적용
- 네이버페이 금/토/일 캐시백 이벤트 처리 (2,000원 이상 결제 시 500원 캐시백)
- 통신사 멤버십 + 네이버페이 주말 캐시백 조합 처리 (통신사 할인 후 남은 금액으로 네이버페이 결제)
- **매장별 특화된 할인 규칙 적용 (CU의 KT 멤버십 시간 제한 및 상품 카테고리 제한 등)**

#### `utils/discountUtils.ts`

할인 처리를 위한 보조 유틸리티 함수들을 제공합니다.

주요 기능:

- `findOptimalDiscounts`: 금액에 따른 최적 할인 방법 탐색
- `createCombinedDiscount`: 멤버십과 카드 할인을 결합한 중복 할인 정보 생성
- `calculateDiscountAmount`: 특정 할인에 대한 할인액 계산

### 컴포넌트

#### `components/discount/DiscountFilter.tsx`

할인 수단 선택을 위한 필터 컴포넌트입니다.

주요 기능:

- 멤버십 선택 (통신사 멤버십, 네이버 멤버십)
- 결제 방법 선택 (네이버페이, 할인카드)
- 할인카드 할인률 직접 입력
- 선택된 필터 상태 관리 및 부모 컴포넌트로 전달

#### `components/discount/DiscountResult.tsx`

할인도우미의 핵심 UI 컴포넌트로, 선택된 할인 수단에 따른 최적 할인 결과를 표시하는 컴포넌트입니다.

주요 기능:

- **storeId 프로퍼티를 통해 매장별 맞춤형 할인 정책 적용**
- 금액 입력 및 POP 로고 유무 선택 UI
- 기본 금액(5,000원) 제시
- 입력 필드 포커스 시 자동 비우기
- 계산식 직접 입력 지원 (1200+800 등의 수식 계산)
- +1,000원, +100원 버튼으로 빠른 금액 추가
- 초기화 버튼으로 금액을 0원으로 리셋
- 현재 금액에 대한 최적 할인 조합 목록 표시
- 할인액, 최종 금액, 할인율 정보 제공
- 즉시 할인과 미래 혜택을 구분하여 아이콘과 툴팁으로 명확하게 표시
- 체감가 정보 제공 (원래 금액에서 즉시 할인과 미래 혜택을 모두 차감한 금액)
- 체감가에 대한 툴팁 설명 제공
- 주말(금/토/일) 및 네이버페이 선택 시 캐시백 이벤트 안내 메시지 표시
- 네이버페이 주말 캐시백 이벤트 신청 링크 제공
- 통신사 멤버십 + 네이버페이 주말 캐시백 조합에 대한 할인 정보 표시
- 할인 유형별 배지(즉시할인, 포인트적립, 캐시백, 카드할인) 표시
- 최적 할인 방법에 대한 상세 혜택 정보 제공
- 최적 할인 방법은 아이콘, 색상, 테두리로 시각적 강조 표시
- 반응형 디자인: 화면 크기에 따라 다른 UI 제공
  - 모바일: 탭 기반 UI (최적 할인, 전체 목록, 용어 설명)로 정보 분류 제공
    - '최적 할인' 탭: 최적의 할인 방법을 한눈에 요약 표시
    - '전체 목록' 탭: 카드 형태 UI, 카드 헤더 터치 시 상세 정보 펼침/접기 지원
    - '용어 설명' 탭: 할인 금액 관련 용어(총 혜택, 즉시 할인, 미래 혜택, 체감가 등) 설명
  - 데스크톱: 테이블 형태로 모든 정보를 한눈에 표시

### 페이지

#### `app/store/[id]/page.tsx`

개별 매장의 할인 정보를 보여주는 페이지입니다.

주요 기능:

- 매장 정보 로드 및 표시
- URL 파라미터를 통해 받은 매장 ID(id)를 DiscountResult 컴포넌트에 전달
- 매장별 할인 정책이 자동으로 적용되어 해당 매장에 맞는 최적 할인 계산
- DiscountFilter와 DiscountResult 컴포넌트 조합
- 할인 필터 상태 관리
- 로딩 및 에러 상태 처리

### 타입 정의

#### `types/discountFilter.ts`

할인 필터 관련 타입 정의를 제공합니다.

주요 타입:

- `IDiscountFilter`: 사용자가 선택한 할인 수단 정보를 담는 인터페이스
  - 통신사 멤버십 (T, KT, U+)
  - 네이버 멤버십
  - 결제 방법 (네이버페이, 카카오페이, 토스페이)
  - 할인카드 설정

#### `types/discount.ts`

할인 정보 관련 타입 정의를 제공합니다.

주요 타입:

- `DiscountType`: 할인 유형 열거형 (멤버십, 간편결제, 카드 등)
- `IDiscountInfo`: 할인 정보 인터페이스
- `IDiscountCalculationResult`: 할인 계산 결과 인터페이스
  - 할인 방법, 설명, 원래 금액
  - instantDiscountAmount: 즉시 할인 금액 (결제 시점에 차감)
  - futureDiscountAmount: 미래 할인 금액 (적립금, 캐시백 등 후속 혜택)
  - totalBenefitAmount: 총 혜택 금액 (즉시 할인 + 미래 할인)
  - finalAmount: 실제 결제 금액 (원래 금액 - 즉시 할인)
  - perceivedAmount: 체감가 (원래 금액 - 즉시 할인 - 미래 할인)
  - 할인율, 순위, 기타 정보 포함
  - 네이버페이 주말 캐시백과 같은 특별 이벤트 정보 처리

### 데이터 및 유틸리티

#### `lib/data/stores.ts`

매장 정보 데이터를 관리합니다.

주요 기능:

- 매장 목록 및 상세 정보 제공
- 매장 카테고리 정보
- 현재 지원 매장:
  - GS25
  - CU
  - 세븐일레븐
  - 이마트24

#### `lib/data/discountRules.ts`

매장별 할인 정책 데이터를 정의하고 관리합니다.

주요 기능:

- 매장별 할인 정책을 체계적으로 정의하는 인터페이스(IDiscountRule) 제공
- 각 매장의 통신사 멤버십 할인 세부 정보 관리
  - 통신사별 할인율, 제한사항, 제외상품 등
- 네이버 멤버십 할인 정보 관리
  - 즉시할인율, 포인트적립율, 최대적립한도, 상품제한 등
- 네이버페이 주말 캐시백 정보 관리
- 매장 ID로 할인 정책을 조회하는 getDiscountRules 함수 제공
- 현재 지원 매장별 할인 정책:
  - GS25 (storeId: "1")
  - CU (storeId: "2")
  - 세븐일레븐 (storeId: "3")
  - 이마트24 (storeId: "4")

#### `lib/discount/filterDiscounts.ts`

선택된 필터에 따라 적용 가능한 할인을 필터링합니다.

주요 기능:

- 사용자 선택에 따른 할인 필터링
- 통신사 멤버십, 네이버 멤버십, 결제 방법별 할인 필터링

### 커스텀 훅

#### `hooks/useMediaQuery.ts`

반응형 UI를 위한 미디어 쿼리 훅입니다.

주요 기능:

- CSS 미디어 쿼리 문자열을 받아 현재 화면 크기가 조건에 맞는지 여부를 반환
- window.matchMedia API를 사용하여 브라우저 화면 크기 변화 감지
- 컴포넌트에서 미디어 쿼리 결과에 따라 조건부 렌더링 지원
- 모바일/데스크톱 등 다양한 화면 크기에 대응하는 UI 구현에 활용

사용 예:

```typescript
const isMobile = useMediaQuery("(max-width: 768px)");

// isMobile 값에 따라 다른 UI 렌더링
return isMobile ? <MobileUI /> : <DesktopUI />;
```

### 레이아웃 및 설정

#### `app/layout.tsx`

Next.js 애플리케이션의 루트 레이아웃을 정의하는 파일입니다.

주요 기능:

- 전역 폰트 설정 (Geist Sans, Geist Mono)
- SEO 최적화를 위한 메타데이터 설정:
  - 타이틀 및 설명
  - 키워드 목록
  - OpenGraph 메타데이터 (동적 URL 처리)
  - Twitter 카드 메타데이터
  - 파비콘 및 앱 아이콘
  - 검색엔진 최적화 설정
  - 모바일 최적화 뷰포트
- 환경변수 기반 동적 URL 설정:
  - `NEXT_PUBLIC_BASE_URL`: 배포 환경에 따른 기본 URL 설정
  - 개발 환경: http://localhost:3000
  - 프로덕션 환경: https://discount-helper.pages.dev
  - OpenGraph 이미지, canonical URL 등에 활용
- Google Analytics 통합
- 반응형 레이아웃 구조
- 다국어 지원 (한국어)
